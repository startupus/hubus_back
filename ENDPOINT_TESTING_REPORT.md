# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ endpoints –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è JWT authentication

–î–∞—Ç–∞: 2025-10-12  
–í—Ä–µ–º—è: 12:04

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚úÖ JWT Authentication –≤ API Gateway
**–ü—Ä–æ–±–ª–µ–º–∞:** JWT Strategy –Ω–µ –≤—ã–∑—ã–≤–∞–ª–∞—Å—å, –≤—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ 401 Unauthorized.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω `PassportModule.register({ defaultStrategy: 'jwt' })` –≤ `AuthModule`
- –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π `PassportModule` –∏–∑ `AppModule`
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `AuthModule` –≤ `ModelsModule` –∏ –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ JwtAuthGuard
- –£–ª—É—á—à–µ–Ω `JwtAuthGuard` —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ NestJS Logger
- –î–æ–±–∞–≤–ª–µ–Ω `handleRequest` –º–µ—Ç–æ–¥ –≤ JwtAuthGuard –¥–ª—è –ª—É—á—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `services/api-gateway/src/app.module.ts`
- `services/api-gateway/src/auth/auth.module.ts`
- `services/api-gateway/src/auth/jwt.strategy.ts`
- `services/api-gateway/src/auth/jwt-auth.guard.ts`
- `services/api-gateway/src/models/models.module.ts`
- `services/api-gateway/src/ai-certification/ai-certification.module.ts`
- `services/api-gateway/src/ai-certification/ai-safety.controller.ts`
- `services/api-gateway/src/ai-certification/ai-classification.controller.ts`

### 2. ‚úÖ Models Endpoints
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ endpoints:**
- `GET /v1/models` - ‚úÖ 200 OK (14 –º–æ–¥–µ–ª–µ–π)
- `GET /v1/models/providers` - ‚úÖ 200 OK
- `GET /v1/models/categories` - ‚úÖ 200 OK

### 3. ‚úÖ API Keys Endpoints
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ endpoints:**
- `GET /v1/auth/api-keys` - ‚úÖ 200 OK
- `POST /v1/auth/api-keys` - ‚úÖ 201 Created

### 4. ‚úÖ Billing Endpoints
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ endpoints:**
- `GET /v1/billing/balance` - ‚úÖ 200 OK
- `GET /v1/billing/transactions` - ‚úÖ 200 OK
- `GET /v1/billing/report` - ‚úÖ 200 OK

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Endpoint `/v1/billing/usage` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, endpoint –Ω–µ –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)

### 5. ‚úÖ Chat Endpoints
**–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ endpoints:**
- `POST /v1/chat/completions` - ‚úÖ 201 Created

### 6. ‚úÖ History Endpoints
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ endpoints:**
- `GET /v1/history/requests` - ‚úÖ 200 OK
- `GET /v1/history/sessions` - ‚úÖ 200 OK
- `GET /v1/history/stats` - ‚úÖ 200 OK

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Endpoint `/v1/history` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint - `/v1/history/requests`

### 7. ‚úÖ Analytics Endpoints
**–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ endpoints:**
- `GET /v1/analytics/metrics` - ‚úÖ 200 OK

### 8. ‚ö†Ô∏è FSB Endpoints
**–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (403 Forbidden - –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ endpoints:**
- `GET /v1/fsb/statistics` - ‚ö†Ô∏è 403 Forbidden (—Ç—Ä–µ–±—É–µ—Ç —Ä–æ–ª—å 'fsb')

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** FSB endpoints –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞—â–∏—â–µ–Ω—ã –∏ —Ç—Ä–µ–±—É—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ä–æ–ª—å 'fsb'. –≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è endpoints, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–ª—è –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–ª—É–∂–±.

### 9. ‚úÖ AI Certification Endpoints
**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç

**–†–∞–±–æ—Ç–∞—é—â–∏–µ endpoints:**
- `GET /v1/ai/certification/levels` - ‚úÖ 200 OK
- `GET /v1/ai/certification/all` - ‚úÖ 200 OK

**–ù–µ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ endpoints (–∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤):**
- `GET /v1/ai/safety/levels` - ‚ùå ENOTFOUND safety-service
- `GET /v1/ai/classification/categories` - ‚ùå ENOTFOUND classification-service

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** AI Safety –∏ AI Classification endpoints –ø—ã—Ç–∞—é—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –≤–Ω–µ—à–Ω–∏–º –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º (safety-service, classification-service), –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è MVP.

### 10. ‚ÑπÔ∏è Anonymization Endpoints
**–°—Ç–∞—Ç—É—Å:** –ù–µ –∏–º–µ–µ—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö endpoints

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Anonymization —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–µ—Ä–≤–∏—Å –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FSB Controller'–æ–º. –ü—É–±–ª–∏—á–Ω—ã–µ endpoints –¥–ª—è anonymization –Ω–µ –±—ã–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, —á—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

## –û–±—â–∏–π –∏—Ç–æ–≥

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **JWT Authentication** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **Models Endpoints** - –≤—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç (3/3)
3. **API Keys Endpoints** - –≤—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç (2/2)
4. **Billing Endpoints** - –≤—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç (3/3)
5. **Chat Endpoints** - —Ä–∞–±–æ—Ç–∞–µ—Ç (1/1)
6. **History Endpoints** - –≤—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç (3/3)
7. **Analytics Endpoints** - —Ä–∞–±–æ—Ç–∞–µ—Ç (1/1)
8. **AI Certification Endpoints** - —á–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç (2/4)

### ‚ö†Ô∏è –û–∂–∏–¥–∞–µ–º—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
1. **FSB Endpoints** - —Ç—Ä–µ–±—É—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ä–æ–ª—å (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
2. **AI Safety/Classification** - —Ç—Ä–µ–±—É—é—Ç –≤–Ω–µ—à–Ω–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (–¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
3. **Anonymization** - –Ω–µ—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö endpoints (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ)

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- **–í—Å–µ–≥–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:** 18 endpoints
- **–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:** 15 endpoints (83%)
- **–û–∂–∏–¥–∞–µ–º—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:** 3 endpoints (17%)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:** 0

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AI Safety Service** - —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è safety assessment
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AI Classification Service** - —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è AI model classification
3. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** - –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö endpoints
4. **–î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã** - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
5. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** - –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ endpoints —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. JWT authentication –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–ª–æ—Å—å. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

Endpoints, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç (AI Safety –∏ AI Classification), —Ç—Ä–µ–±—É—é—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω–µ—à–Ω–∏—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –±—É–¥—É—â–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ MVP.

