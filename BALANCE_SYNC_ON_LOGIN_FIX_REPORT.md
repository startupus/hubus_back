# üéâ –û–¢–ß–ï–¢: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –ë–ê–õ–ê–ù–°–ê –ü–†–ò –í–•–û–î–ï

## üìã –ü—Ä–æ–±–ª–µ–º–∞

**–ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞, –∞ –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Å—Ä–∞–∑—É –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É.

## üîç –ê–Ω–∞–ª–∏–∑

### **–ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. **–°—Ç–∞—Ç–∏—á–Ω—ã–π –±–∞–ª–∞–Ω—Å –ø—Ä–∏ –≤—Ö–æ–¥–µ** - –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Ö–æ–¥–∞ –±–∞–ª–∞–Ω—Å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –∫–∞–∫ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `100`
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - `fetchUserInfo` –Ω–µ –ø–æ–ª—É—á–∞–ª —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–ª–∞–Ω—Å–∞** - –ø—Ä–∏ –≤—Ö–æ–¥–µ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### **1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É**

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```javascript
onLogin({
  id: response.data.user.id,
  email: response.data.user.email,
  balance: 100,  // ‚ùå –°—Ç–∞—Ç–∏—á–Ω—ã–π –±–∞–ª–∞–Ω—Å
  currency: 'USD'
});
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```javascript
// –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
try {
  const balanceResponse = await axios.get('/billing/balance');
  onLogin({
    id: response.data.user.id,
    email: response.data.user.email,
    balance: balanceResponse.data.balance?.balance || 0,  // ‚úÖ –†–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
    currency: balanceResponse.data.balance?.currency || 'USD'
  });
} catch (balanceError) {
  console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–ª–∞–Ω—Å–∞:', balanceError);
  // Fallback –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É –±–∞–ª–∞–Ω—Å—É
  onLogin({
    id: response.data.user.id,
    email: response.data.user.email,
    balance: 0,  // ‚úÖ Fallback –∫ 0
    currency: 'USD'
  });
}
```

### **2. –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```javascript
const fetchUserInfo = async () => {
  try {
    const response = await axios.get('/billing/balance');
    setUser({
      id: response.data.user?.id || 'unknown',  // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
      email: response.data.user?.email || 'unknown@example.com',
      balance: response.data.balance?.balance || 0,
      currency: response.data.balance?.currency || 'USD'
    });
  } catch (err) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  }
};
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```javascript
const fetchUserInfo = async () => {
  try {
    // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏–∑ —Ç–æ–∫–µ–Ω–∞
    const token = localStorage.getItem('token');
    if (!token) {
      setUser(null);
      return;
    }

    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º JWT —Ç–æ–∫–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    const payload = JSON.parse(atob(token.split('.')[1]));
    const userId = payload.sub || payload.id;
    const userEmail = payload.email;

    // –ó–∞—Ç–µ–º –ø–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å
    const balanceResponse = await axios.get('/billing/balance');
    
    setUser({
      id: userId || 'unknown',  // ‚úÖ –ò–∑ JWT —Ç–æ–∫–µ–Ω–∞
      email: userEmail || 'unknown@example.com',  // ‚úÖ –ò–∑ JWT —Ç–æ–∫–µ–Ω–∞
      balance: balanceResponse.data.balance?.balance || 0,  // ‚úÖ –†–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
      currency: balanceResponse.data.balance?.currency || 'USD'
    });
  } catch (err) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –æ—á–∏—Å—Ç–∫–æ–π —Ç–æ–∫–µ–Ω–∞
  }
};
```

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### **‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã:**

1. **–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É:**
   - ‚úÖ –ë–∞–ª–∞–Ω—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –≤—Ö–æ–¥–µ
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - ‚úÖ Fallback –∫ 0 –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
   - ‚úÖ –ë–∞–ª–∞–Ω—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
   - ‚úÖ –ë–∞–ª–∞–Ω—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
   - ‚úÖ –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### **üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–ª–∞–Ω—Å–∞:**
```
–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É ‚Üí JWT —Ç–æ–∫–µ–Ω ‚Üí API Gateway ‚Üí Billing Service ‚Üí PostgreSQL
     ‚Üì              ‚Üì            ‚Üì              ‚Üì
  React State   localStorage   HTTP API    Decimal Math
```

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
1. **–í—Ö–æ–¥:** `POST /auth/login` ‚Üí JWT —Ç–æ–∫–µ–Ω ‚Üí `GET /billing/balance` ‚Üí –†–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** JWT —Ç–æ–∫–µ–Ω –∏–∑ localStorage ‚Üí –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí `GET /billing/balance` ‚Üí –†–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
3. **Fallback:** –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Üí –ë–∞–ª–∞–Ω—Å = 0, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = null

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|----------|
| üîê **–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ë–∞–ª–∞–Ω—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –≤—Ö–æ–¥–µ |
| üîÑ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –±–∞–ª–∞–Ω—Å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è |
| üíæ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ë–∞–ª–∞–Ω—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ PostgreSQL |
| üîÑ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ |
| üõ°Ô∏è **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | Fallback –∏ –æ—á–∏—Å—Ç–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ |

## üöÄ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!** 

–¢–µ–ø–µ—Ä—å –±–∞–ª–∞–Ω—Å:
- ‚úÖ **–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –≤—Ö–æ–¥–µ** –≤ —Å–∏—Å—Ç–µ–º—É
- ‚úÖ **–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏** —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö** —Å —Ç–æ—á–Ω—ã–º–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üéä

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 13 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** üü¢ **–ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–û**
