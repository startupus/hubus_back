# üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ –û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ò –°–ò–°–¢–ï–ú–´

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∏–ª–ª–∏–Ω–≥–∞
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å `Decimal` —Ç–∏–ø–∞–º–∏ –≤ `balance-security.service.ts`
- **–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å `number` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ `Decimal` –º–µ—Ç–æ–¥—ã
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ë–∞–ª–∞–Ω—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ò–ò

### ‚úÖ 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –≤ auth-service
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω `SyncController` –≤ billing-service –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å –≤ billing-service

### ‚úÖ 3. –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–°—Ç–∞—Ç—É—Å**: –£–°–ü–ï–®–ù–û
- **–î–µ—Ç–∞–ª–∏**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ auth-service
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ billing-service —Å –±–∞–ª–∞–Ω—Å–æ–º 100 USD

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ **–°—Ç–∞—Ç—É—Å**: –£–°–ü–ï–®–ù–û  
- **–î–µ—Ç–∞–ª–∏**: JWT —Ç–æ–∫–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–ë–∞–ª–∞–Ω—Å**: –î–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ API Gateway

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ò–ò –º–æ–¥–µ–ª–∏
- ‚úÖ **–°—Ç–∞—Ç—É—Å**: –£–°–ü–ï–®–ù–û
- **–î–µ—Ç–∞–ª–∏**: –ó–∞–ø—Ä–æ—Å –∫ GPT-3.5-turbo –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- **–û—Ç–≤–µ—Ç**: "Hello! How can I assist you today?..."

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü—Ä—è–º–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ billing
- ‚úÖ **–°—Ç–∞—Ç—É—Å**: –£–°–ü–ï–®–ù–û
- **–î–µ—Ç–∞–ª–∏**: Billing events –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–°—Ç–æ–∏–º–æ—Å—Ç—å**: 0.05 USD –∑–∞ 5 —Ç–æ–∫–µ–Ω–æ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: Health checks
- ‚úÖ **–°—Ç–∞—Ç—É—Å**: –í–°–ï –°–ï–†–í–ò–°–´ –†–ê–ë–û–¢–ê–Æ–¢
- **API Gateway**: ‚úÖ Healthy
- **Auth Service**: ‚úÖ Healthy  
- **Billing Service**: ‚úÖ Healthy
- **Provider Orchestrator**: ‚úÖ Healthy
- **Proxy Service**: ‚úÖ Healthy

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. Billing Service
```typescript
// –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
const currentBalance = balance.balance.toNumber(); // ‚ùå –ü–æ—Ç–µ—Ä—è —Ç–æ—á–Ω–æ—Å—Ç–∏
const newBalance = currentBalance - amountToDebit; // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞

// –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è  
const currentBalance = balance.balance instanceof Decimal ? balance.balance : new Decimal(balance.balance);
const newBalance = currentBalance.minus(amountToDebit); // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞
```

### 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```typescript
// Auth Service - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
await this.syncWithBillingService(company);

// Billing Service - –Ω–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
@Post('company')
async syncCompany(@Body() data: CompanySyncData) {
  // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –±–∞–ª–∞–Ω—Å–∞
}
```

### 3. API Gateway
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã URL –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ auth-service
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü–æ—Ä—Ç | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
|-----------|--------|------|-------------|
| API Gateway | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 3000 | PostgreSQL (5437) |
| Auth Service | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 3001 | PostgreSQL (5432) |
| Billing Service | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 3004 | PostgreSQL (5433) |
| Provider Orchestrator | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 3002 | PostgreSQL (5434) |
| Proxy Service | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 3003 | - |
| RabbitMQ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 5672/15672 | - |
| Redis | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 6379 | - |

## üéØ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API Gateway
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å billing-service
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤

### ‚úÖ –ë–∏–ª–ª–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∞
- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (100 USD)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ billing events
- –¢–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å Decimal

### ‚úÖ –ò–ò –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –ó–∞–ø—Ä–æ—Å—ã –∫ –≤–Ω–µ—à–Ω–∏–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ provider-orchestrator
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ proxy-service

### ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- Health checks –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ RabbitMQ

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Retry –ª–æ–≥–∏–∫–∞
- Graceful shutdown

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–í—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**: < 1 —Å–µ–∫—É–Ω–¥—ã
- **–í—Ä–µ–º—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**: < 500ms
- **–í—Ä–µ–º—è –ò–ò –∑–∞–ø—Ä–æ—Å–∞**: ~2-3 —Å–µ–∫—É–Ω–¥—ã (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞)
- **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ billing**: < 100ms

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–°–ò–°–¢–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–ê –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ!**

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∏–ª–ª–∏–Ω–≥–æ–º
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ò–ò –º–æ–¥–µ–ª–µ–π
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ health checks

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ! üöÄ
