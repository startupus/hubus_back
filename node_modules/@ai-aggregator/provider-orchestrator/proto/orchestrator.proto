syntax = "proto3";

package orchestrator;

// Provider Orchestrator Service Definition
service ProviderOrchestratorService {
  // Route request to best provider
  rpc RouteRequest(RouteRequestRequest) returns (RouteRequestResponse);
  
  // Get available providers
  rpc GetProviders(GetProvidersRequest) returns (GetProvidersResponse);
  
  // Get provider status
  rpc GetProviderStatus(GetProviderStatusRequest) returns (GetProviderStatusResponse);
  
  // Update provider configuration
  rpc UpdateProviderConfig(UpdateProviderConfigRequest) returns (UpdateProviderConfigResponse);
  
  // Get routing rules
  rpc GetRoutingRules(GetRoutingRulesRequest) returns (GetRoutingRulesResponse);
  
  // Update routing rules
  rpc UpdateRoutingRules(UpdateRoutingRulesRequest) returns (UpdateRoutingRulesResponse);
  
  // Get load balancing info
  rpc GetLoadBalancingInfo(GetLoadBalancingInfoRequest) returns (GetLoadBalancingInfoResponse);
}

// Request/Response Messages
message RouteRequestRequest {
  string user_id = 1;
  string request_type = 2; // "chat", "completion", "embedding"
  string model = 3;
  int32 max_tokens = 4;
  double temperature = 5;
  string prompt = 6;
  map<string, string> parameters = 7;
}

message RouteRequestResponse {
  bool success = 1;
  string message = 2;
  string provider = 3;
  string endpoint = 4;
  map<string, string> headers = 5;
  double estimated_cost = 6;
  int32 estimated_tokens = 7;
}

message GetProvidersRequest {
  string status = 1; // "active", "inactive", "all"
  string type = 2; // "openai", "openrouter", "all"
}

message GetProvidersResponse {
  bool success = 1;
  string message = 2;
  repeated ProviderInfo providers = 3;
}

message GetProviderStatusRequest {
  string provider_id = 1;
}

message GetProviderStatusResponse {
  bool success = 1;
  string message = 2;
  ProviderStatus status = 3;
}

message UpdateProviderConfigRequest {
  string provider_id = 1;
  ProviderConfig config = 2;
}

message UpdateProviderConfigResponse {
  bool success = 1;
  string message = 2;
  ProviderInfo provider = 3;
}

message GetRoutingRulesRequest {
  string user_id = 1;
}

message GetRoutingRulesResponse {
  bool success = 1;
  string message = 2;
  repeated RoutingRule rules = 3;
}

message UpdateRoutingRulesRequest {
  string user_id = 1;
  repeated RoutingRule rules = 2;
}

message UpdateRoutingRulesResponse {
  bool success = 1;
  string message = 2;
  repeated RoutingRule rules = 3;
}

message GetLoadBalancingInfoRequest {
  string provider_type = 1;
}

message GetLoadBalancingInfoResponse {
  bool success = 1;
  string message = 2;
  LoadBalancingInfo info = 3;
}

// Data Types
message ProviderInfo {
  string id = 1;
  string name = 2;
  string type = 3;
  string status = 4; // "active", "inactive", "maintenance"
  string endpoint = 5;
  string api_key = 6;
  ProviderConfig config = 7;
  ProviderMetrics metrics = 8;
  string created_at = 9;
  string updated_at = 10;
}

message ProviderConfig {
  string name = 1;
  string endpoint = 2;
  string api_key = 3;
  double cost_per_token = 4;
  int32 max_tokens = 5;
  double timeout = 6;
  int32 retry_attempts = 7;
  double retry_delay = 8;
  map<string, string> headers = 9;
  repeated string supported_models = 10;
}

message ProviderMetrics {
  int32 total_requests = 1;
  int32 successful_requests = 2;
  int32 failed_requests = 3;
  double avg_response_time = 4;
  double success_rate = 5;
  double total_cost = 6;
  string last_request_at = 7;
}

message ProviderStatus {
  string provider_id = 1;
  string status = 2;
  bool is_healthy = 3;
  double response_time = 4;
  int32 active_connections = 5;
  int32 queue_size = 6;
  string last_health_check = 7;
  string error_message = 8;
}

message RoutingRule {
  string id = 1;
  string user_id = 2;
  string condition = 3; // JSON string with conditions
  string provider_id = 4;
  int32 priority = 5;
  bool is_active = 6;
  string created_at = 7;
  string updated_at = 8;
}

message LoadBalancingInfo {
  string provider_type = 1;
  int32 total_providers = 2;
  int32 active_providers = 3;
  double total_capacity = 4;
  double current_load = 5;
  repeated ProviderLoad provider_loads = 6;
}

message ProviderLoad {
  string provider_id = 1;
  double current_load = 2;
  double capacity = 3;
  int32 active_requests = 4;
  double avg_response_time = 5;
}
