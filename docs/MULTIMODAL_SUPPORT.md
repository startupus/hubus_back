# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–∞—É–¥–∏–æ/–≤–∏–¥–µ–æ/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

## ‚úÖ –¢–µ–∫—É—â–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### Endpoint: `POST /api/v1/chat/completions`

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–î–î–ï–†–ñ–ò–í–ê–ï–¢** –ø–µ—Ä–µ–¥–∞—á—É –∞—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ –≤ –º–æ–¥–µ–ª—è—Ö

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ó–∞–ø—Ä–æ—Å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å** - `external-api.controller.ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `@Body() request: any`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ª—é–±–æ–π —Ñ–æ—Ä–º–∞—Ç
2. **–ó–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ OpenRouter –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π** - `proxy-service` –ø–µ—Ä–µ–¥–∞–µ—Ç –≤–µ—Å—å –æ–±—ä–µ–∫—Ç –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞–ø—Ä—è–º—É—é –≤ OpenRouter API
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç** - ValidationPipe –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å `forbidNonWhitelisted: false`, –ø–æ—ç—Ç–æ–º—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (audio, video) –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

## üìù –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞

### 1. –¢–µ–∫—Å—Ç (–æ–±—ã—á–Ω—ã–π)
```json
{
  "role": "user",
  "content": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?"
}
```

### 2. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (Vision API)
```json
{
  "role": "user",
  "content": [
    {
      "type": "text",
      "text": "–û–ø–∏—à–∏ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
    },
    {
      "type": "image_url",
      "image_url": {
        "url": "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
      }
    }
  ]
}
```

### 3. –ê—É–¥–∏–æ (GPT-4o Audio Preview, Voxtral)
```json
{
  "role": "user",
  "content": [
    {
      "type": "text",
      "text": "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–π —ç—Ç–æ –∞—É–¥–∏–æ"
    },
    {
      "type": "audio",
      "audio": {
        "url": "data:audio/mpeg;base64,..."
      }
    }
  ]
}
```

### 4. –í–∏–¥–µ–æ (GPT-4o)
```json
{
  "role": "user",
  "content": [
    {
      "type": "text",
      "text": "–û–ø–∏—à–∏ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —ç—Ç–æ–º –≤–∏–¥–µ–æ"
    },
    {
      "type": "video",
      "video": {
        "url": "data:video/mp4;base64,..."
      }
    }
  ]
}
```

### 5. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è (—Ç–µ–∫—Å—Ç + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ + –∞—É–¥–∏–æ + –≤–∏–¥–µ–æ)
```json
{
  "role": "user",
  "content": [
    {
      "type": "text",
      "text": "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—Å–µ —ç—Ç–æ"
    },
    {
      "type": "image_url",
      "image_url": {
        "url": "data:image/jpeg;base64,..."
      }
    },
    {
      "type": "audio",
      "audio": {
        "url": "data:audio/mpeg;base64,..."
      }
    },
    {
      "type": "video",
      "video": {
        "url": "data:video/mp4;base64,..."
      }
    }
  ]
}
```

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- DTO –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `text` –∏ `image_url` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- `audio` –∏ `video` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å, –Ω–æ –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ
- ValidationPipe –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å `forbidNonWhitelisted: false`, –ø–æ—ç—Ç–æ–º—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ proxy-service
- –ó–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ OpenRouter **–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π**: `const requestBody = request;`
- OpenRouter —Å–∞–º —Ä–µ—à–∞–µ—Ç, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ –º–æ–¥–µ–ª—å —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞, OpenRouter –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É

### –û–±–µ–∑–ª–∏—á–∏–≤–∞–Ω–∏–µ
- –û–±–µ–∑–ª–∏—á–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É
- –ê—É–¥–∏–æ, –≤–∏–¥–µ–æ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –æ–±–µ–∑–ª–∏—á–∏–≤–∞—é—Ç—Å—è (–ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å)

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–§–æ—Ä–º–∞—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏**
   - –ù–µ –≤—Å–µ –º–æ–¥–µ–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤—Å–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - GPT-4o –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ
   - GPT-4o-audio-preview –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞—É–¥–∏–æ (–Ω–µ –≤–∏–¥–µ–æ)
   - Voxtral –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞—É–¥–∏–æ

2. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤**
   - Base64 —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 33%
   - –î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å URL –≤–º–µ—Å—Ç–æ base64
   - OpenRouter –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

3. **–¢–∞–π–º–∞—É—Ç—ã**
   - –î–ª—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ç–∞–π–º–∞—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ 10 –º–∏–Ω—É—Ç (600000ms)
   - –î–ª—è –±–æ–ª—å—à–∏—Ö –≤–∏–¥–µ–æ/–∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏

## üìã –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è Habus

### –ü—Ä–∏–º–µ—Ä 1: –ê—É–¥–∏–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —á–µ—Ä–µ–∑ GPT-4o Audio Preview
```bash
curl -X POST "http://host.docker.internal:3005/api/v1/chat/completions" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "openai/gpt-4o-audio-preview",
    "messages": [
      {
        "role": "user",
        "content": [
          {
            "type": "text",
            "text": "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–π —ç—Ç–æ –∞—É–¥–∏–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ"
          },
          {
            "type": "audio",
            "audio": {
              "url": "data:audio/mpeg;base64,..."
            }
          }
        ]
      }
    ]
  }'
```

### –ü—Ä–∏–º–µ—Ä 2: –í–∏–¥–µ–æ –∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ GPT-4o
```bash
curl -X POST "http://host.docker.internal:3005/api/v1/chat/completions" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "openai/gpt-4o",
    "messages": [
      {
        "role": "user",
        "content": [
          {
            "type": "text",
            "text": "–û–ø–∏—à–∏ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —ç—Ç–æ–º –≤–∏–¥–µ–æ"
          },
          {
            "type": "video",
            "video": {
              "url": "data:video/mp4;base64,..."
            }
          }
        ]
      }
    ]
  }'
```

### –ü—Ä–∏–º–µ—Ä 3: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è (—Ç–µ–∫—Å—Ç + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ + –∞—É–¥–∏–æ)
```bash
curl -X POST "http://host.docker.internal:3005/api/v1/chat/completions" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "openai/gpt-4o",
    "messages": [
      {
        "role": "user",
        "content": [
          {
            "type": "text",
            "text": "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –∞—É–¥–∏–æ"
          },
          {
            "type": "image_url",
            "image_url": {
              "url": "data:image/jpeg;base64,..."
            }
          },
          {
            "type": "audio",
            "audio": {
              "url": "data:audio/mpeg;base64,..."
            }
          }
        ]
      }
    ]
  }'
```

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç

**–î–ê, –Ω–∞—à API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ –≤ –º–æ–¥–µ–ª—è—Ö!**

- Endpoint `/api/v1/chat/completions` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `type: "audio"` –∏ `type: "video"` –≤ –º–∞—Å—Å–∏–≤–µ `content`
- –ó–∞–ø—Ä–æ—Å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ OpenRouter –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- OpenRouter —Å–∞–º —Ä–µ—à–∞–µ—Ç, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ –º–æ–¥–µ–ª—å —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ –≤—Å–µ –º–æ–¥–µ–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤—Å–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `gpt-4o` –¥–ª—è –≤–∏–¥–µ–æ)
- –§–æ—Ä–º–∞—Ç base64 —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞

