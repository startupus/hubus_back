# –ü—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ç–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞ OAuth Flow

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **Frontend –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç OAuth flow:**
   ```
   [LOG] üîÑ OAuth flow detected, redirecting to /api/oauth/authorize
   ```

2. **Frontend –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç API endpoints:**
   ```
   [LOG] ‚ö†Ô∏è On API endpoint, skipping frontend processing: /oauth/authorize
   ```

3. **–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Loginus —Ä–∞–±–æ—Ç–∞–µ—Ç** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ `/oauth/authorize` (–±–µ–∑ `/api/`), –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ –≤–º–µ—Å—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ backend.**

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ Loginus
2. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ `/api/oauth/authorize?client_id=...&redirect_uri=...&state=...`
3. ‚úÖ Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
4. ‚úÖ Backend —Å–æ–∑–¥–∞–µ—Ç authorization code
5. ‚úÖ Backend —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ callback URL: `http://localhost:80/v1/auth/callback?code=...&state=...`

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ Loginus
2. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ `/oauth/authorize` (–±–µ–∑ `/api/`)
3. ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ (frontend —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
4. ‚ùå Backend –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å

## –ü—Ä–∏—á–∏–Ω–∞

**Frontend —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/api/oauth/authorize`, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ `/oauth/authorize` (–±–µ–∑ `/api/`).**

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:
- –õ–∏–±–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–∞ `/oauth/authorize` –≤–º–µ—Å—Ç–æ `/api/oauth/authorize`)
- –õ–∏–±–æ backend –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `/oauth/authorize` (—Ç–æ–ª—å–∫–æ `/api/oauth/authorize`)

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ frontend

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ `/api/oauth/authorize` (—Å `/api/`):

```javascript
// –í frontend: index.html
if (oauthFlow && returnTo) {
  // –í–∞–∂–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å /api/ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
  const apiReturnTo = returnTo.startsWith('/api/') ? returnTo : `/api${returnTo}`;
  window.location.href = apiReturnTo;
  return;
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Backend –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ–±–∞ –ø—É—Ç–∏

Backend –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–∞–∫ `/oauth/authorize`, —Ç–∞–∫ –∏ `/api/oauth/authorize`:

```typescript
// –í backend: oauth.controller.ts
@Get('authorize')
@Get('oauth/authorize')  // –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ—Ç —Ä–æ—É—Ç
async authorize(...) {
  // ...
}
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
2. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ `/api/oauth/authorize?client_id=...`
3. Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
4. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `http://localhost:80/v1/auth/callback?code=...&state=...`

## –†–µ–∑—é–º–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** Frontend —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/oauth/authorize` (–±–µ–∑ `/api/`), –Ω–æ backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ `/api/oauth/authorize`

**–†–µ—à–µ–Ω–∏–µ:** 
- –õ–∏–±–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ frontend –Ω–∞ `/api/oauth/authorize`
- –õ–∏–±–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `/oauth/authorize` –≤ backend

**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ Loginus (frontend –∏–ª–∏ backend)

