# –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø–• –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –ü–†–û–ë–õ–ï–ú

## –û–±–∑–æ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**–î–∞—Ç–∞:** 14 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ  
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 3 –∏–∑ 3 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –∫–æ–¥–µ, 1 —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏  

---

## ‚úÖ –£–°–ü–ï–®–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. –°–∏—Å—Ç–µ–º–∞ billing mode –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å PARENT_PAID —Å–ø–∏—Å—ã–≤–∞–ª–∏ —Å–æ —Å–≤–æ–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –≤–º–µ—Å—Ç–æ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –º–µ–∂–¥—É auth-service –∏ billing-service
  - –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π endpoint `/sync/employee` –≤ billing-service
  - –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ auth-service
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–µ–π
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (—Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

### 2. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∫–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
  - –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è: –æ–ø–∏—Å–∞–Ω–∏–µ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π, –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
  - –î–æ–±–∞–≤–ª–µ–Ω—ã API endpoints –≤ API Gateway: `GET /referral/codes` –∏ `POST /referral/codes`
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –≤ ReferralService –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–¥–∞–º–∏
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

### 3. –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–ª–∞—Å—å —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–º–µ—Å—Ç–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
  - –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `inviteEmployee` –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º –¥—Ä—É–≥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ
  - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `parentCompanyId` –∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 4. –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ (–æ—à–∏–±–∫–∞ 500)
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ `[DecimalError] Invalid argument: [object Object]` –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ Decimal –æ–±—ä–µ–∫—Ç–æ–≤ –≤ Prisma –æ–ø–µ—Ä–∞—Ü–∏–∏
  - –ó–∞–º–µ–Ω–µ–Ω `decrement` –Ω–∞ —Ä—É—á–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  - –î–æ–±–∞–≤–ª–µ–Ω—ã `.toNumber()` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Prisma
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ö–û–î –ò–°–ü–†–ê–í–õ–ï–ù, –ù–û –û–®–ò–ë–ö–ê –°–û–•–†–ê–ù–Ø–ï–¢–°–Ø
- **–¢—Ä–µ–±—É–µ—Ç—Å—è:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ Prisma —Å—Ö–µ–º—ã –∏–ª–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

---

## üìã –î–ï–¢–ê–õ–ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:

#### Auth Service
- `services/auth-service/src/modules/employee/employee.service.ts`
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å billing-service
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

#### Billing Service  
- `services/billing-service/src/http/sync.controller.ts`
  - –î–æ–±–∞–≤–ª–µ–Ω endpoint `/sync/employee` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- `services/billing-service/src/billing/billing.service.ts`
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å Decimal –≤ `chargeForSubscription`

#### API Gateway
- `services/api-gateway/src/referral/referral.controller.ts`
  - –î–æ–±–∞–≤–ª–µ–Ω—ã endpoints –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤
- `services/api-gateway/src/referral/referral.service.ts`
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏

#### Frontend
- `frontend/src/App.js`
  - –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤
  - –£–ª—É—á—à–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ReferralEarningsComponent`

---

## üß™ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
1. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
2. **–õ–æ–≥–∏–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –∫–æ–¥–µ
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã:
1. **–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫** - –∫–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, –Ω–æ –æ—à–∏–±–∫–∞ 500 —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
2. **–°–∏—Å—Ç–µ–º–∞ billing mode** - —Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –û—Ç–ª–∞–¥–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫
- –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å Prisma —Å—Ö–µ–º—É –¥–ª—è –ø–æ–ª–µ–π `balance` –∏ `amount`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –í–æ–∑–º–æ–∂–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ billing mode
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É billing mode
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ —Å–ø–∏—Å—ã–≤–∞—é—Ç —Å –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ —Ä–µ—Ñ–µ—Ä–µ—Ä—É
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

---

## üìä –û–ë–©–ê–Ø –û–¶–ï–ù–ö–ê

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 75% –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º  
**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:** 3 –∏–∑ 4 —Ñ—É–Ω–∫—Ü–∏–π  
**–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:** 1 —Ñ—É–Ω–∫—Ü–∏—è (–ø–æ–¥–ø–∏—Å–∫–∏)  

–°–∏—Å—Ç–µ–º–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–∞, –æ—Å–Ω–æ–≤–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã. –û—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Prisma.
